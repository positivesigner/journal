--[under folder /sdcard/qlua5]
--Create subdir share/5.3
--Put in a copy of def.lua

print()

def_tcompile = {'function tcompile(ur_table) load(table.concat(ur_table, "\\r"))() end'}
load(table.concat(def_tcompile, "\r"))()

def_ti = {'function ti(ur_table, ur_line) table.insert(ur_table, ur_line) end'}
tcompile(def_ti)

def_tia = {}
ti(def_tia, 'function tia(ur_table)')
ti(def_tia, '  local strASSIGN = ur_table .. " = {}; " ')
ti(def_tia, '  strASSIGN = strASSIGN .. "function tii(ur_line) ti(" .. ur_table .. ", ur_line) end" ')
ti(def_tia, '  load(strASSIGN)() ')
ti(def_tia, '  end')
tcompile(def_tia)

tia 'def_printk'
tii 'function printk(ur_table)'
tii '  local pk = {}'
tii '  for k in pairs(ur_table) do'
tii '    table.insert(pk, k)'
tii '    end'
tii '  table.sort(pk)'
tii '  for k,v in pairs(pk) do print(v) end'
tii '  end'
tcompile(def_printk)

tia 'def_printv'
tii 'function printv(ur_table)'
tii '  local pk = {}'
tii '  for k,v in pairs(ur_table) do'
tii '    table.insert(pk, v)'
tii '    end'
tii '  table.sort(pk)'
tii '  for k,v in pairs(pk) do print(v) end'
tii '  end'
tcompile(def_printv)

tia 'def_tcopy'
tii 'function tcopy(ur_src_table, ur_dest_table)'
tii '  for k,v in pairs(ur_src_table) do'
tii '    table.insert(ur_dest_table, v)'
tii '    end'
tii '  end'
tcompile(def_tcopy)

tia 'def_printiv'
tii 'function printiv(ur_table)'
tii '  for k,v in pairs(ur_table) do'
tii '    print(v)'
tii '    end'
tii '  end'
tcompile(def_printiv)

tia 'def_printkv'
tii 'function printkv(ur_table)'
tii '  local pk = {}'
tii '  for k in pairs(ur_table) do'
tii '    table.insert(pk, k)'
tii '    end'
tii '  table.sort(pk)'
tii '  for k,v in pairs(pk) do print(v .. ": " .. type(ur_table[v]) ) end'
tii '  end'
tcompile(def_printkv)

tia 'def_ioexec'
tii 'function ioexec(ur_cmd)'
tii '  local iofile = io.popen(ur_cmd)'
tii '  local retTABLE = {}'
tii '  for k in iofile:lines() do table.insert(retTABLE, k) end'
tii '  iofile:close()'
tii '  return retTABLE'
tii '  end'
tcompile(def_ioexec)

tia 'def_printio'
tii 'function printio(ur_cmd)'
tii '  printiv(ioexec(ur_cmd))'
tii '  end'
tcompile(def_printio)

--printio('ls /storage')
local ttbFILE = ioexec('find /sdcard/Download -name "TWMove_*.htm" -print')
local strFILE = ""
for k,v in pairs(ttbFILE) do
  strFILE = v
  break
  end

print('1: ' .. strFILE)